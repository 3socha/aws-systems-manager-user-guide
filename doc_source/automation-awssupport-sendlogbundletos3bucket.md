# AWSSupport-SendLogBundleToS3Bucket

## Description

The AWSSupport-SendLogBundleToS3Bucket Automation document uploads a log bundle generated by the EC2Rescue tool from the target instance to the specified S3 bucket. The automation execution installs the platform specific version of EC2Rescue based on the platform of the target instance. EC2Rescue is then used to collect all the available operating system (OS) logs.

## Document Type

Automation

## Owner

Amazon

## Platform(s)

Windows, Linux

## Parameters

### InstanceId

* **Type**: String
* **Allowed pattern**: ^[m]{0,1}i-[a-z0-9]{8,17}$
* **Description**: (Required) The ID of the Windows or Linux managed instance you want to collect logs from.

### S3BucketName

* **Type**: String
* **Allowed pattern**: \^[_a-zA-Z0-9][-._a-zA-Z0-9]{2,62}$
* **Description**: (Required) S3 bucket to upload the logs to.

### S3Path

* **Type**: String
* **Allowed pattern**: \^[a-zA-Z0-9][-./a-zA-Z0-9]{0,255}/$
* **Default**: AWSSupport-SendLogBundleToS3Bucket/
* **Description**: (Required) S3 path for the collected logs.

### AutomationAssumeRole

* **Type**: String
* **Description**: (Optional) The ARN of the role that allows Automation to perform the actions on your behalf. If no role is specified, Systems Manager Automation uses the permissions of the user that executes this document.

## Examples

### Collect logs from INSTANCEID and upload them to S3 Bucket mybucket

```json
aws ssm start-automation-execution --document-name AWSSupport-SendLogBundleToS3Bucket --parameters "InstanceId=INSTANCEID, S3BucketName=mybucket"
```

### Retrieve the execution output

```json
aws ssm get-automation-execution --automation-execution-id EXECUTIONID --output text --query 'AutomationExecution.Output'
```

## Required IAM Permissions

It is recommended that the EC2 instance receiving the command has an IAM role with the **AmazonEC2RoleforSSM** Amazon managed policy attached.
The user must have at least **ssm:ExecuteAutomation** and **ssm:SendCommand** to execute the automation and send the command to the instance, plus **ssm:GetAutomationExecution** to be able to read the automation output.

## Document Version

Document Steps:

1. **aws:configurePackage** - Install EC2Rescue via AWS-ConfigureAWSPackage
2. The second step depends on the OS platform:
- (Windows) **aws:runPowerShellScript** - Executes the PowerShell script to collect Windows troubleshooting logs with EC2Rescue.
- (Linux) **aws:runShellScript** - Executes the bash script to collect Linux troubleshooting logs with EC2Rescue.
